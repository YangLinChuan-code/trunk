"use strict";(globalThis["webpackChunktrunk"]=globalThis["webpackChunktrunk"]||[]).push([[477],{4477:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ke});a(9665),a(6727);var s=a(9835),l=a(6970),i=a(499),n=(a(2941),a(6827)),o=a(7712),d=a(8339);const c={class:"row justify-between items-center"},u={class:"col-2"},r={class:"col-8 overflow-auto",style:{"max-height":"70px"}},v={class:"col-2 text-right"},m={class:"exit"},p={key:0,class:"selected"},w={key:1,class:"q-mt-sm"},_={key:2,class:"q-mt-sm"},g={class:"map-actions"},k={class:"map-indicate"},f={class:"map-indicate__item"},h={class:"map-indicate__available"},y={class:"map-indicate__item"},b={class:"map-indicate__occupied"},$={class:"map-indicate__item"},z={class:"map-indicate__reserved"},q={class:"map-indicate__item"},x={class:"map-indicate__locking"},D={class:"map-indicate__item"},W={class:"map-indicate__selection"},C={class:"map-buttons"},E={key:0,class:"q-mt-md row justify-end"},H={class:"col-11 text-subtitle1"},T={class:"col-1 text-right"},L={class:"row"},U={class:"row"},j={key:0,class:"row items-center"},Y={key:0,class:"dialog-status__occupied"},S={key:1,class:"dialog-status__reserved"},Z={key:2,class:"dialog-status__locking"},Q={key:3,class:"dialog-status__available"},R={class:"row"},O={key:1,class:"row"},X={key:2,class:"row q-col-gutter-md",style:{"max-width":"300px",margin:"auto"}},F={key:0,class:"col-12"},V={class:"col-12"},A={key:3,class:"row q-col-gutter-md",style:{"max-width":"300px",margin:"auto"}},G={key:0,class:"col-12"},I={key:1,class:"col-12"},P={key:2,class:"col-6"},K={class:"row"},M={class:"row"},B={class:"row items-center"},J={key:0,class:"dialog-status__occupied"},N={key:1,class:"dialog-status__reserved"},ee={key:2,class:"dialog-status__locking"},te={key:3,class:"dialog-status__available"},ae={class:"row"},se={__name:"Map",setup(e){const t=(0,s.f3)("post"),{t:a}=(0,o.QT)(),se=((0,d.yj)(),(0,d.tv)()),le=(0,i.qj)({visible:!1,data:{}}),ie=(0,i.iH)(!1),ne=(0,i.iH)([]),oe=(0,s.Fl)((()=>ne.value.filter((e=>2===e.status)).length>0)),de={STORAGE:0,PILLAR:1,CROSS:2,DOOR:3};let ce=(0,i.iH)(!1);function ue(e){if(!ie.value)return le.visible=!0,le.data=e;const t=ne.value.findIndex((t=>t===e));t<0?(0==e.status&&ne.value.push(e),2==e.status&&ne.value.push(e)):ne.value.splice(t,1)}function re(){const e={...ne.value};return e.id=[],e.name=[],e.extent=0,e.price=0,ne.value.forEach(((t,a)=>{e.id.push(t.id),e.name.push(t.name),e.extent+=t.extent,e.price+=t.price})),e.id=e.id.join(","),e.name=e.name.join(","),le.visible=!0,le.data=e}function ve(e){e||(ne.value=[])}function me(e){return ne.value.includes(e)}const pe=(0,i.iH)(),we=(0,i.qj)({data:{name:"",extent:0,status:0},position:{x:0,y:0},visible:!1}),_e=(0,s.Fl)((()=>({transform:`translate(${we.position.x}px,${we.position.y}px)`,visibility:we.visible?"visible":"hidden",opacity:we.visible?1:0}))),ge=(e,t)=>{let{pageX:a,pageY:s}=e,{clientWidth:l,clientHeight:i}=pe.value||{clientWidth:0,clientHeight:0};const{clientHeight:n,clientWidth:o}=document.documentElement;a+l>o&&(a-=l),s+i>n&&(s-=i),we.position.x=a,we.position.y=s,we.visible=!0,we.data=t},ke=(0,s.Fl)((()=>e=>{const{line:t,col:a,type:s,status:l}=e,i={};return t>1&&(i["rowspan"]=t),a>1&&(i["colspan"]=a),s===de.STORAGE?(i["class"]=0==l?me(e)?"storage status0 selected":"storage status0":1==l?me(e)?"storage status1 selected":"storage status1":2==l?me(e)?"storage status2 selected":"storage status2":me(e)?"storage selected":"storage",i["ondblclick"]=()=>ue(e),i["onmouseenter"]=t=>{ge(t,e)},i["onmouseleave"]=e=>{we.visible=!1}):s===de.DOOR?i["class"]="door":s===de.PILLAR?i["class"]="pillar":i["class"]="cross",i})),fe=(0,i.iH)([]),he=(0,i.qj)({scale:1,transformX:0,transformY:0,isTransition:!0}),ye=(0,s.Fl)((()=>({transform:`translate(${he.transformX}px,${he.transformY}px) scale(${he.scale})`,"transition-duration":he.isTransition?"0.3s":"0s",cursor:he.isTransition?"":"grabbing"}))),be=(0,i.iH)();let $e=0,ze=0,qe=0,xe=0;const De=e=>{e.preventDefault(),e instanceof TouchEvent&&(e=e.targetTouches[0]),he.transformX=e.pageX-$e+qe,he.transformY=e.pageY-ze+xe};function We(e){$e=e.pageX||e.targetTouches[0].pageX,ze=e.pageY||e.targetTouches[0].pageY,qe=he.transformX,xe=he.transformY,he.isTransition=!1,document.addEventListener("mousemove",De,{passive:!1}),document.addEventListener("touchmove",De,{passive:!1})}function Ce(){$e=0,ze=0,he.isTransition=!0,document.removeEventListener("mousemove",De),document.removeEventListener("touchmove",De)}(0,i.iH)(0);(0,s.bv)((()=>{be.value.addEventListener("mousedown",We,{passive:!1}),document.addEventListener("mouseup",Ce,{passive:!1}),be.value.addEventListener("touchstart",We,{passive:!1}),be.value.addEventListener("touchend",Ce,{passive:!1}),be.value.addEventListener("mousewheel",(e=>{const t=e.deltaY;t<0?he.scale+=.1:he.scale=Math.max(.1,he.scale-.1)}),{passive:!1}),Ee(),window.addEventListener("ws-UpdateHouse",(async function(e){const t=e.data?.data??null;console.log("ws-UpdateHouse",t),t&&t.forEach((e=>{fe.value.forEach((t=>{t.find((t=>{t.id==e.id&&(t.status=e.status)}))}))}))}))}));const Ee=()=>{t("/home_page/storehouse_list",{info:fe.value},(e=>{"success"===e.status?fe.value=e.info:n.Z.create({message:e.message,position:"top",color:"negative"})}))},He=e=>{se.push(`/storageunit/view/${e}`)},Te=e=>{let t=e.quote_id;2==e.status?se.push(`/quotation/view/${t}`):1==e.status&&se.push(`/order/check/${t}`)},Le=e=>{se.push(`/quotation/add/${e}`)},Ue=e=>{se.push(`/quotation/add/${e}`)},je=e=>{se.push(`/order/create/${e}`)},Ye=e=>{se.push(`/order/create/${e}`)};return(e,t)=>{const a=(0,s.up)("q-toggle"),n=(0,s.up)("q-chip"),o=(0,s.up)("q-btn"),d=(0,s.up)("q-icon"),se=(0,s.up)("q-btn-group"),ue=(0,s.up)("q-card-section"),ge=(0,s.up)("q-card"),$e=(0,s.up)("q-dialog"),ze=(0,s.up)("q-page"),qe=(0,s.Q2)("close-popup");return(0,s.wg)(),(0,s.j4)(ze,{padding:"",ontouchmove:"event.preventDefault()"},{default:(0,s.w5)((()=>[(0,s._)("div",c,[(0,s._)("div",u,[(0,s.Wm)(a,{modelValue:ie.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>ie.value=e),ve],label:e.$t("多選")},null,8,["modelValue","label"])]),(0,s._)("div",r,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(ne.value,((e,t)=>((0,s.wg)(),(0,s.j4)(n,{color:"primary","text-color":"white",key:t},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.name),1)])),_:2},1024)))),128))]),(0,s._)("div",v,[(0,s.Wm)(o,{color:"primary",unelevated:"",label:e.$t("全屏"),onClick:t[1]||(t[1]=e=>(0,i.dq)(ce)?ce.value=!0:ce=!0)},null,8,["label"])])]),(0,s._)("div",{class:(0,l.C_)(["map",{fullscreen:(0,i.SU)(ce)}]),ref_key:"mapRef",ref:be},[(0,s._)("div",m,[(0,s.Wm)(o,{color:"primary",label:e.$t("退出全屏"),onClick:t[2]||(t[2]=e=>(0,i.dq)(ce)?ce.value=!1:ce=!1)},null,8,["label"])]),(0,s._)("table",{style:(0,l.j5)((0,i.SU)(ye))},[(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(fe.value,((e,t)=>((0,s.wg)(),(0,s.iD)("tr",{key:t},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e,((e,a)=>((0,s.wg)(),(0,s.iD)("td",(0,s.dG)((0,i.SU)(ke)(e),{key:""+t+a}),[me(e)?((0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(d,{name:"done"})])):(0,s.kq)("",!0),(0,s._)("div",null,(0,l.zw)(e.name),1),e.type===de.STORAGE?((0,s.wg)(),(0,s.iD)("div",w,(0,l.zw)(e.extent?.toFixed(1)??e.extent),1)):e.extent?((0,s.wg)(),(0,s.iD)("div",_,(0,l.zw)(e.extent),1)):(0,s.kq)("",!0)],16)))),128))])))),128))])],4)],2),(0,s._)("div",g,[(0,s._)("div",k,[(0,s._)("div",f,[(0,s._)("div",h,[(0,s._)("span",null,(0,l.zw)(e.$t("可用")),1)])]),(0,s._)("div",y,[(0,s._)("div",b,[(0,s._)("span",null,(0,l.zw)(e.$t("佔用")),1)])]),(0,s._)("div",$,[(0,s._)("div",z,[(0,s._)("span",null,(0,l.zw)(e.$t("保留")),1)])]),(0,s._)("div",q,[(0,s._)("div",x,[(0,s._)("span",null,(0,l.zw)(e.$t("鎖定")),1)])]),(0,s._)("div",D,[(0,s._)("div",W,[(0,s._)("span",null,(0,l.zw)(e.$t("當前選擇")),1)])])]),(0,s._)("div",C,[(0,s.Wm)(se,null,{default:(0,s.w5)((()=>[(0,s.Wm)(o,{icon:"add",onClick:t[3]||(t[3]=e=>he.scale+=.1)}),(0,s.Wm)(o,{icon:"remove",onClick:t[4]||(t[4]=e=>he.scale=Math.max(.1,he.scale-.1))})])),_:1})])]),ne.value.length>0?((0,s.wg)(),(0,s.iD)("div",E,[(0,s.Wm)(o,{color:"primary",rounded:"",label:e.$t("下一步"),onClick:re},null,8,["label"])])):(0,s.kq)("",!0),(0,s.Wm)($e,{modelValue:le.visible,"onUpdate:modelValue":t[11]||(t[11]=e=>le.visible=e)},{default:(0,s.w5)((()=>[(0,s.Wm)(ge,{flat:"",style:{width:"75vw"}},{default:(0,s.w5)((()=>[(0,s.Wm)(ue,{class:"row justify-between"},{default:(0,s.w5)((()=>[(0,s._)("div",H,(0,l.zw)(le.data.name),1),(0,s._)("div",T,[(0,s.wy)((0,s.Wm)(d,{name:"close",size:"1.2rem",class:"cursor-pointer"},null,512),[[qe]])])])),_:1}),(0,s.Wm)(ue,{class:"q-col-gutter-md"},{default:(0,s.w5)((()=>[ne.value.length<=1?((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s._)("div",L,(0,l.zw)(e.$t("倉庫面積："))+" "+(0,l.zw)(le.data.extent?.toFixed(1)??le.data.extent),1),(0,s._)("div",U,(0,l.zw)(e.$t("倉庫價格："))+" $"+(0,l.zw)(e.fmtCurrency(le.data.price)),1),(0,i.SU)(oe)?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",j,[(0,s.Uk)((0,l.zw)(e.$t("狀態："))+" ",1),1===we.data.status?((0,s.wg)(),(0,s.iD)("div",Y,(0,l.zw)(e.$t("佔用")),1)):2===we.data.status?((0,s.wg)(),(0,s.iD)("div",S,(0,l.zw)(e.$t("保留")),1)):3===we.data.status?((0,s.wg)(),(0,s.iD)("div",Z,(0,l.zw)(e.$t("鎖定")),1)):((0,s.wg)(),(0,s.iD)("div",Q,(0,l.zw)(e.$t("可用")),1))])),(0,s._)("div",R,(0,l.zw)(e.$t("備注："))+" "+(0,l.zw)(le.data.remark),1)],64)):((0,s.wg)(),(0,s.iD)("div",O,(0,l.zw)(e.$t("已選倉庫："))+" "+(0,l.zw)(ne.value.length),1)),ie.value?((0,s.wg)(),(0,s.iD)("div",X,[(0,i.SU)(oe)?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",F,[(0,s.Wm)(o,{onClick:t[5]||(t[5]=e=>Ue(le.data.id)),size:"1rem",unelevated:"",rounded:"",color:"primary",class:"full-width",label:e.$t("建立報價")},null,8,["label"])])),(0,s._)("div",V,[(0,s.Wm)(o,{onClick:t[6]||(t[6]=e=>Ye(le.data.id)),size:"1rem",unelevated:"",rounded:"",color:"positive",class:"full-width",label:e.$t("建立訂單")},null,8,["label"])])])):(0,s.kq)("",!0),ie.value?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",A,[0===we.data.status?((0,s.wg)(),(0,s.iD)("div",G,[(0,s.Wm)(o,{onClick:t[7]||(t[7]=e=>Le(we.data.id)),size:"1rem",unelevated:"",rounded:"",color:"primary",class:"full-width",label:e.$t("建立報價")},null,8,["label"])])):(0,s.kq)("",!0),1!==we.data.status?((0,s.wg)(),(0,s.iD)("div",I,[(0,s.Wm)(o,{onClick:t[8]||(t[8]=e=>je(we.data.id)),size:"1rem",unelevated:"",rounded:"",color:"positive",class:"full-width",label:e.$t("建立訂單")},null,8,["label"])])):(0,s.kq)("",!0),(0,s._)("div",{class:(0,l.C_)(""+(0!==we.data.status?"col-6":"col-12"))},[(0,s.Wm)(o,{size:"1rem",unelevated:"",rounded:"",color:"warning",class:"full-width",onClick:t[9]||(t[9]=e=>He(we.data.id)),label:e.$t("歷史記錄")},null,8,["label"])],2),0!==we.data.status?((0,s.wg)(),(0,s.iD)("div",P,[(0,s.Wm)(o,{onClick:t[10]||(t[10]=e=>Te(we.data)),size:"1rem",unelevated:"",rounded:"",color:"info",class:"full-width",label:e.$t("詳情")},null,8,["label"])])):(0,s.kq)("",!0)]))])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,s._)("div",{class:"popup",ref_key:"popupEl",ref:pe,style:(0,l.j5)((0,i.SU)(_e))},[(0,s.Wm)(ge,null,{default:(0,s.w5)((()=>[(0,s.Wm)(ue,null,{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(we.data.name),1)])),_:1}),(0,s.Wm)(ue,{class:"q-pt-none q-col-gutter-md"},{default:(0,s.w5)((()=>[(0,s._)("div",K,(0,l.zw)(e.$t("倉庫面積："))+" "+(0,l.zw)(we.data.extent?.toFixed(1)??we.data.extent),1),(0,s._)("div",M,(0,l.zw)(e.$t("倉庫價格："))+" $"+(0,l.zw)(e.fmtCurrency(we.data.price)),1),(0,s._)("div",B,[(0,s.Uk)((0,l.zw)(e.$t("狀態："))+" ",1),1===we.data.status?((0,s.wg)(),(0,s.iD)("div",J,(0,l.zw)(e.$t("佔用")),1)):2===we.data.status?((0,s.wg)(),(0,s.iD)("div",N,(0,l.zw)(e.$t("保留")),1)):3===we.data.status?((0,s.wg)(),(0,s.iD)("div",ee,(0,l.zw)(e.$t("鎖定")),1)):((0,s.wg)(),(0,s.iD)("div",te,(0,l.zw)(e.$t("可用")),1))]),(0,s._)("div",ae,(0,l.zw)(e.$t("備注："))+" "+(0,l.zw)(we.data.remark),1)])),_:1})])),_:1})],4)])),_:1})}}};var le=a(1639),ie=a(9885),ne=a(3175),oe=a(7691),de=a(8879),ce=a(2857),ue=a(7236),re=a(2074),ve=a(4458),me=a(3190),pe=a(2146),we=a(9984),_e=a.n(we);const ge=(0,le.Z)(se,[["__scopeId","data-v-bd5505ea"]]),ke=ge;_e()(se,"components",{QPage:ie.Z,QToggle:ne.Z,QChip:oe.Z,QBtn:de.Z,QIcon:ce.Z,QBtnGroup:ue.Z,QDialog:re.Z,QCard:ve.Z,QCardSection:me.Z}),_e()(se,"directives",{ClosePopup:pe.Z})}}]);