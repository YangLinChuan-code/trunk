"use strict";(globalThis["webpackChunktrunk"]=globalThis["webpackChunktrunk"]||[]).push([[117,98],{2937:(e,t,l)=>{l.r(t),l.d(t,{default:()=>N});l(5633),l(9665);var o=l(9835),a=l(6970),s=l(499),n=l(8339),i=l(7712),u=l(6827),m=l(8126),d=l(831),c=l(1986),r=l(2819),_=l(6882),p=l(9226),f=l(3062);const v={class:"text-h5"},b={class:"row justify-between"},g={class:"row items-start q-gutter-sm"},w={class:"row items-start q-gutter-sm"},h={class:"text-subtitle1 q-mb-md"},q={key:0,class:"q-my-md"},U={class:"row items-center"},V={class:"q-ml-sm"},y={class:"text-subtitle1 q-mb-md required"},S={class:"row"},W={class:"row"},$={class:"col-6"},Z={class:"row q-mt-xs q-gutter-md"},k={class:"required"},z={class:"required"},x={class:"q-mt-md q-gutter-sm"},Q=["data"],j={__name:"Add",setup(e){const t=(0,n.tv)(),l=(0,n.yj)(),{t:j}=(0,i.QT)(),C=(0,o.f3)("post"),F=(0,s.iH)(!1);let I=(0,s.qj)({discount_type:1,discount:0,discount_total:(0,o.Fl)((()=>I.storehouse_info.reduce(((e,t)=>e+Number(t.discount)),0))),expected_lease_time:"",storehouse_info:[],remarks:[],customer:{id:"",type:0,code:"",client_register_name:"",client_id_code:"",client_address:"",client_phone:"",client_telephone:"",client_email:"",whatsapp:"",client_bank_name:"",client_account:"",client_account_name:"",contact_ename:"",contact_name:"",contact_id_code:"",contact_address:"",contact_phone:"",contact_telephone:"",contact_email:"",id_code_file:"",address_identify:"",declare_url:"",other_url:"",br_url:"",company_seal_url:"",client_company_ename:"",client_company_name:"",client_contact_ename:"",client_contact_name:"",client_certificate:"",client_due_date:"",client_register_ename:"",client_contact_position:""},ordernum:"",num:""});const O=(0,s.qj)({customer:[]}),P=(0,s.qj)({visible:!1}),T=(0,s.qj)({loading:!1,url:"",visible:!1}),A=e=>{const t=O.customer.find((t=>t.id===e));for(const l in t)I.customer[l]=t[l]},D=(e,t)=>{if(""===String(e).trim())return t((()=>{}));C("/quote/customer_info",{name:e},(e=>{"success"===e.status&&t((()=>{O.customer=e.info}))}))},B=e=>{const t={};for(const l in e)Object.hasOwn(I.customer,l)&&(t[l]=e[l]);t.id=e.id,t.name=0===e.type?t.client_register_ename:t.client_company_ename,O.customer.push(t),I.search_info=e.id,A(e.id),P.visible=!1};(0,o.bv)((()=>{E(),G()}));const E=()=>{let e=l.params.id;e&&"0"!==e&&(e=e.split(","),H(e))},H=e=>{C("/quote/mapselected",e,(e=>{"success"===e.status&&(I.storehouse_info=e.info.map((e=>({...e,prepayment:1,discount:"0.00",total:e.price}))))}))},L=(0,s.iH)(),R=()=>{L.value.validate().then((e=>e?I.storehouse_info.length<1?u.Z.create({message:j("請選擇倉庫"),position:"top",color:"negative"}):(F.value=!0,void C("/quote/add_quote",I,(e=>{"success"===e.status?(F.value=!1,u.Z.create({message:e.message,position:"top",color:"positive"}),t.go(-1)):u.Z.create({message:e.message,position:"top",color:"negative"})}))):document.activeElement?.scrollIntoView({behavior:"smooth"})))},N=e=>{for(const a in e)Object.hasOwn(I.customer,a)&&(I.customer[a]=e[a]);const{id:t,type:l}=e;I.search_info=t,e["name"]=0===l?e.client_register_ename:e.client_company_ename;const o=O.customer.findIndex((e=>e.id===t));o<0?O.customer.push(e):O.customer[o]=e},G=()=>{C("/quote/quote_order_num",{},(e=>{"success"===e.status?(I.ordernum=e.ordernum,I.num=e.num):u.Z.create({message:e.message,position:"top",color:"negative"})}))},J=(0,s.qj)({visible:!1,loading:!1,title:(0,o.Fl)((()=>{const e=m.Z.getItem("storehouse_name_id"),t=m.Z.getItem("storeList")??[],l=t.find((t=>t.id===e))??{name:"",id:""};return`${j("報價單設定")}    ${l.name}`})),form:{short_name:"",num:""},rules:{short_name:[e=>e&&e.length>0||j("請輸入前綴")],num:[e=>String(e)&&""!==String(e).trim()||j("請輸入起始數")]}}),K=()=>{J.loading=!0,C("/quote/quote_order_num_info",{},(e=>{"success"===e.status?(J.form.short_name=e.info.short_name,J.form.num=e.info.num,J.loading=!1,J.visible=!0):(J.loading=!1,u.Z.create({message:e.message,position:"top",color:"negative"}))}))},M=()=>{C("/quote/quote_order_num_set",J.form,(e=>{"success"===e.status?(J.visible=!1,G(),u.Z.create({message:j("修改成功"),position:"top",color:"positive"})):u.Z.create({message:e.message,position:"top",color:"negative"})}))},X=()=>{L.value.validate().then((e=>{if(!e)return document.activeElement?.scrollIntoView({behavior:"smooth"});T.loading=!0;const t=sessionStorage.getItem("name");let l={form:I,user_name:t};C("/quote/preview_quote_pdf",l,(e=>{"success"===e.status?(T.url=e.info["pdfurl"],T.loading=!1,T.visible=!0):u.Z.create({message:j("預覽失敗"),position:"top",color:"negative"})}))}))};return(e,t)=>{const l=(0,o.up)("q-card-section"),n=(0,o.up)("q-icon"),i=(0,o.up)("q-select"),u=(0,o.up)("q-btn"),m=(0,o.up)("q-input"),j=(0,o.up)("q-btn-toggle"),C=(0,o.up)("date"),E=(0,o.up)("q-card"),H=(0,o.up)("q-form"),G=(0,o.up)("q-page"),Y=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.j4)(G,{padding:""},{default:(0,o.w5)((()=>[(0,o.Wm)(H,{ref_key:"formRef",ref:L},{default:(0,o.w5)((()=>[(0,o.Wm)(E,{class:"q-pa-sm"},{default:(0,o.w5)((()=>[(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",v,(0,a.zw)(e.$t("新增報價")),1)])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",b,[(0,o._)("div",g,[(0,o.Wm)(i,{dense:"",outlined:"",modelValue:(0,s.SU)(I).search_info,"onUpdate:modelValue":[t[0]||(t[0]=e=>(0,s.SU)(I).search_info=e),A],"map-options":"","use-input":"","emit-value":"","option-value":"id","option-label":"name",options:O.customer,onFilter:D,label:e.$t("搜索客戶"),style:{width:"250px"}},{append:(0,o.w5)((()=>[(0,o.Wm)(n,{name:"search"})])),_:1},8,["modelValue","options","label"]),(0,o.Wm)((0,s.SU)(f.Z),{onSelected:N,isQuote:1}),(0,o.Wm)(u,{color:"primary",onClick:t[1]||(t[1]=e=>P.visible=!0)},{default:(0,o.w5)((()=>[(0,o.Uk)((0,a.zw)(e.$t("新客戶")),1)])),_:1})]),(0,o._)("div",w,[(0,o.Wm)(m,{dense:"",outlined:"",modelValue:(0,s.SU)(I).ordernum,"onUpdate:modelValue":t[2]||(t[2]=e=>(0,s.SU)(I).ordernum=e),label:e.$t("報價單編號"),rules:[t=>t&&t.length>0||e.$t("請輸入報價單編號")]},null,8,["modelValue","label","rules"]),(0,o.Wm)(u,{loading:J.loading,color:"primary",label:e.$t("修改"),onClick:K},null,8,["loading","label"])])])])),_:1}),(0,o.Wm)(l,{class:"q-pb-none"},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(c.Z),{modelValue:(0,s.SU)(I).customer,"onUpdate:modelValue":t[3]||(t[3]=e=>(0,s.SU)(I).customer=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",h,(0,a.zw)(e.$t("折扣資訊")),1),((0,o.wg)(),(0,o.iD)("div",q,[(0,o.Wm)(j,{modelValue:(0,s.SU)(I).discount_type,"onUpdate:modelValue":t[4]||(t[4]=e=>(0,s.SU)(I).discount_type=e),options:[{label:e.$t("固定金額"),value:1},{label:e.$t("百分比"),value:2}]},null,8,["modelValue","options"])])),(0,o._)("div",U,[(0,o.Wm)(m,{class:"col-5",label:e.$t("折扣(%OFF)"),outlined:"",dense:"",clearable:"",modelValue:(0,s.SU)(I).discount,"onUpdate:modelValue":t[5]||(t[5]=e=>(0,s.SU)(I).discount=e)},null,8,["label","modelValue"]),(0,o._)("span",V,"$"+(0,a.zw)(e.fmtCurrency((0,s.SU)(I).discount_total)),1)])])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",y,(0,a.zw)(e.$t("預計搬入時間")),1),(0,o._)("div",S,[(0,o.Wm)(C,{class:"col-5",rules:[t=>t&&t.length>0||e.$t("請選擇預計搬入時間")],outlined:"",dense:"",clearable:"",modelValue:(0,s.SU)(I).expected_lease_time,"onUpdate:modelValue":t[6]||(t[6]=e=>(0,s.SU)(I).expected_lease_time=e)},null,8,["rules","modelValue"])])])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(r.Z),{modelValue:(0,s.SU)(I).storehouse_info,"onUpdate:modelValue":t[7]||(t[7]=e=>(0,s.SU)(I).storehouse_info=e),discount:(0,s.SU)(I).discount,discount_type:(0,s.SU)(I).discount_type},null,8,["modelValue","discount","discount_type"])])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",W,[(0,o._)("div",$,[(0,o.Wm)((0,s.SU)(_.Z),{modelValue:(0,s.SU)(I).remarks,"onUpdate:modelValue":t[8]||(t[8]=e=>(0,s.SU)(I).remarks=e)},null,8,["modelValue"])])])])),_:1}),(0,o.Wm)(l,null,{default:(0,o.w5)((()=>[(0,o._)("div",Z,[(0,o.Wm)(u,{size:"md",color:"primary",unelevated:"",onClick:R,label:e.$t("儲存")},null,8,["label"]),(0,o.Wm)(u,{to:"/quotation",size:"md",color:"negative",unelevated:"",label:e.$t("返回")},null,8,["label"]),(0,o.Wm)(u,{color:"info",onClick:X,label:e.$t("預覽PDF")},null,8,["label"])])])),_:1})])),_:1})])),_:1},512),(0,o.Wm)((0,s.SU)(d.Z),{modelValue:J.visible,"onUpdate:modelValue":t[11]||(t[11]=e=>J.visible=e),title:J.title},{default:(0,o.w5)((()=>[(0,o.Wm)(H,{style:{width:"90vw","max-width":"350px"},onSubmit:M},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{dense:"",outlined:"","label-slot":"",modelValue:J.form.short_name,"onUpdate:modelValue":t[9]||(t[9]=e=>J.form.short_name=e),rules:J.rules.short_name},{label:(0,o.w5)((()=>[(0,o._)("span",k,(0,a.zw)(e.$t("前綴")),1)])),_:1},8,["modelValue","rules"]),(0,o.Wm)(m,{dense:"",outlined:"","label-slot":"",modelValue:J.form.num,"onUpdate:modelValue":t[10]||(t[10]=e=>J.form.num=e),rules:J.rules.num},{label:(0,o.w5)((()=>[(0,o._)("span",z,(0,a.zw)(e.$t("起始數")),1)])),_:1},8,["modelValue","rules"]),(0,o._)("div",null,(0,a.zw)(e.$t("注意"))+": "+(0,a.zw)(e.$t("單號格式"))+": "+(0,a.zw)(e.$t("前綴"))+" + "+(0,a.zw)(e.$t("年份"))+" + "+(0,a.zw)(e.$t("月份"))+" + "+(0,a.zw)(e.$t("顺序數字")),1),(0,o._)("div",x,[(0,o.Wm)(u,{type:"submit",color:"primary",label:e.$t("保存"),loading:F.value},null,8,["label","loading"]),(0,o.wy)((0,o.Wm)(u,{label:e.$t("取消")},null,8,["label"]),[[Y]])])])),_:1})])),_:1},8,["modelValue","title"]),(0,o.Wm)((0,s.SU)(d.Z),{modelValue:P.visible,"onUpdate:modelValue":t[12]||(t[12]=e=>P.visible=e),title:e.$t("新增客戶")},{default:(0,o.w5)((()=>[(0,o.Wm)((0,s.SU)(p["default"]),{quicky:"",style:{width:"75vw"},prop:P.form,onAdd:B,user_type:1},null,8,["prop"])])),_:1},8,["modelValue","title"]),(0,o.Wm)((0,s.SU)(d.Z),{modelValue:T.visible,"onUpdate:modelValue":t[13]||(t[13]=e=>T.visible=e),title:e.$t("預覽")+"PDF"},{default:(0,o.w5)((()=>[(0,o._)("object",{data:e.resolveAssetsURL(T.url),type:"application/pdf",style:{width:"90vw",height:"80vh","max-width":"1200px"}},null,8,Q)])),_:1},8,["modelValue","title"])])),_:1})}}};var C=l(9885),F=l(8326),I=l(4458),O=l(3190),P=l(2259),T=l(2857),A=l(8879),D=l(6611),B=l(1389),E=l(2146),H=l(9984),L=l.n(H);const R=j,N=R;L()(j,"components",{QPage:C.Z,QForm:F.Z,QCard:I.Z,QCardSection:O.Z,QSelect:P.Z,QIcon:T.Z,QBtn:A.Z,QInput:D.Z,QBtnToggle:B.Z}),L()(j,"directives",{ClosePopup:E.Z})}}]);